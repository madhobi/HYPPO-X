
<!--**************************************************************************************************
 Copyright Â© 2016-2017 Md.Kamruzzaman. All rights reserved.
 The generated code is released under following licenses:
 GNU GENERAL PUBLIC LICENSE, Version 3, 29 June 2007
 --------------------------------------------------------------------------------------------------
 File name: double_dap_temp_gl.html
 Objective: Plot pie chart to the topological object constructed by double filter function DAP and Temperature
 Additional information: NA
 --------------------------------------------------------------------------------------------------
 Contributors                   Date            Task details
 -------------------------    ----------      --------------------
 Md. Kamruzzaman              03/03/2017      Initial version
 
 **************************************************************************************************-->

<html>
	<head>

	</head>
	<body>

		<script type="text/javascript">
			function drawLineWithArrowheads(_canvas, data){

				var ctx = _canvas.getContext('2d');

	            drawLine(_canvas, data);

	            ctx.strokeStyle = data.color;
	            ctx.fillStyle=data.color;

	            // draw the starting arrowhead
	            var startRadians=Math.atan((data.y2-data.y1)/(data.x2-data.x1));
	            startRadians+=((data.x2>data.x1)?-90:90)*Math.PI/180;
	            drawArrowhead(ctx,data.x2,data.y2,startRadians);
	        }

	        function drawArrowhead(ctx,x,y,radians){
	            ctx.save();
	            ctx.beginPath();
	            ctx.translate(x,y);
	            ctx.rotate(radians);
	            ctx.moveTo(0,0);
	            ctx.lineTo(5,20);
	            ctx.lineTo(-5,20);
	            ctx.closePath();
	            ctx.restore();
	            ctx.fill();
	        }

			function drawLine(_canvas, data){
				var ctx = _canvas.getContext('2d');
				ctx.beginPath();
				ctx.moveTo(data.x1, data.y1);
				ctx.lineTo(data.x2, data.y2);
				ctx.lineWidth = data.width;
				// set line color
				ctx.strokeStyle = data.color;
				ctx.stroke();
			}

			function drawText(_canvas, text, position, style){
				var context = _canvas.getContext('2d');

				context.font = style.font;//'bold 10pt Calibri';
				context.fillStyle = style.color;
  				context.fillText(text, (position.x1+position.x2)/2, (position.y1+position.y2)/2);
			}

			function drawPie(_canvas, position, data, _id){
				var total = 0;
				  for (obj of data) {
				    total += obj.value;
				  }

				  var ctx = _canvas.getContext('2d');
				  var previousRadian;
				  var middle = {
				  	// for 3 paths
				    x: position.x,
				    y: 777-position.y,

				    // for all paths
				    //x: position.x+1,
				    //y: position.y-13,
				    radius: position.rad,
				  };
				  
				   //background
				  ctx.beginPath();
				  ctx.arc(middle.x, middle.y, middle.radius, 0, 2 * Math.PI);
				  ctx.closePath();
				  ctx.stroke();
				  ctx.fillStyle = "black";
				  ctx.fill();
				   //end of background

				  for (obj of data) {
				    previousRadian = previousRadian || 0;
				    obj.percentage = parseInt((obj.value / total) * 100)
				    
				    ctx.beginPath();
				    ctx.fillStyle = obj.color;
				    obj.radian = (Math.PI * 2) * (obj.value / total);
				    ctx.moveTo(middle.x, middle.y);
				    //middle.radius - 2 is to add border between the background and the pie chart
				    ctx.arc(middle.x, middle.y, middle.radius - 2, previousRadian, previousRadian + obj.radian, false);
				    ctx.closePath();
				    ctx.fill();
				    ctx.save();
				    ctx.translate(middle.x, middle.y);
				    ctx.fillStyle = "white";
				    ctx.font = middle.radius / 10 + "px Arial";
				    ctx.rotate(previousRadian + obj.radian);
				    //\var labelText = "'" + obj.label + "' " + obj.percentage  + "%";
				    //ctx.fillText(labelText, ctx.measureText(labelText).width / 2, 0);

				    //tx.fillText(_id);
				    ctx.restore();

				    previousRadian += obj.radian;
				  }

			}
		</script>

		<canvas id="myCanvas" width="1455" height="777"></canvas>
		<script type="text/javascript">
			var canvas = document.getElementById('myCanvas');

			var data=[{id:104,p:{x:1018.000000,y:77.000000,rad:21.66}, d:[{label: "BK",value: 18,color: '#ff0000'},{label: "BN",value: 20,color: '#E67E22'}]},{id:93,p:{x:1260.000000,y:524.000000,rad:16.66}, d:[{label: "BK",value: 24,color: '#ff0000'}]},{id:99,p:{x:1263.000000,y:292.000000,rad:18.33}, d:[{label: "BK",value: 30,color: '#ff0000'}]},{id:103,p:{x:987.000000,y:273.000000,rad:15.00}, d:[{label: "BN",value: 15,color: '#E67E22'}]},{id:102,p:{x:1159.000000,y:200.000000,rad:18.33}, d:[{label: "BK",value: 30,color: '#ff0000'}]},{id:56,p:{x:1180.000000,y:548.000000,rad:18.33}, d:[{label: "BK",value: 30,color: '#ff0000'}]},{id:101,p:{x:1207.000000,y:250.000000,rad:20.00}, d:[{label: "BK",value: 36,color: '#ff0000'}]},{id:55,p:{x:1168.000000,y:615.000000,rad:16.66}, d:[{label: "BK",value: 24,color: '#ff0000'}]},{id:68,p:{x:958.000000,y:136.000000,rad:23.33}, d:[{label: "BK",value: 24,color: '#ff0000'},{label: "BN",value: 20,color: '#E67E22'}]},{id:91,p:{x:1258.000000,y:590.000000,rad:15.00}, d:[{label: "BK",value: 18,color: '#ff0000'}]},{id:97,p:{x:1199.000000,y:412.000000,rad:18.33}, d:[{label: "BK",value: 30,color: '#ff0000'}]},{id:28,p:{x:997.000000,y:197.000000,rad:16.66}, d:[{label: "BK",value: 18,color: '#ff0000'},{label: "BN",value: 5,color: '#E67E22'}]},{id:95,p:{x:1219.000000,y:471.000000,rad:20.00}, d:[{label: "BK",value: 36,color: '#ff0000'}]},{id:67,p:{x:1063.000000,y:143.000000,rad:30.00}, d:[{label: "BK",value: 36,color: '#ff0000'},{label: "BN",value: 30,color: '#E67E22'}]},{id:65,p:{x:1050.000000,y:250.000000,rad:20.00}, d:[{label: "BK",value: 24,color: '#ff0000'},{label: "BN",value: 10,color: '#E67E22'}]},{id:64,p:{x:1113.000000,y:297.000000,rad:20.00}, d:[{label: "BK",value: 36,color: '#ff0000'}]},{id:61,p:{x:1177.000000,y:352.000000,rad:21.66}, d:[{label: "BK",value: 42,color: '#ff0000'}]},{id:59,p:{x:1299.000000,y:357.000000,rad:15.00}, d:[{label: "BK",value: 18,color: '#ff0000'}]},{id:98,p:{x:1051.000000,y:406.000000,rad:23.07}, d:[{label: "BN",value: 20,color: '#E67E22'}]},{id:52,p:{x:731.000000,y:167.000000,rad:27.69}, d:[{label: "BN",value: 30,color: '#E67E22'}]},{id:96,p:{x:951.000000,y:395.000000,rad:23.07}, d:[{label: "BN",value: 20,color: '#E67E22'}]},{id:50,p:{x:671.000000,y:92.000000,rad:23.07}, d:[{label: "BN",value: 20,color: '#E67E22'}]},{id:85,p:{x:641.000000,y:184.000000,rad:27.69}, d:[{label: "BN",value: 30,color: '#E67E22'}]},{id:63,p:{x:1097.000000,y:473.000000,rad:20.76}, d:[{label: "BN",value: 15,color: '#E67E22'}]},{id:94,p:{x:797.000000,y:422.000000,rad:20.76}, d:[{label: "BN",value: 15,color: '#E67E22'}]},{id:48,p:{x:565.000000,y:150.000000,rad:25.38}, d:[{label: "BN",value: 25,color: '#E67E22'}]},{id:89,p:{x:733.000000,y:270.000000,rad:25.38}, d:[{label: "BN",value: 25,color: '#E67E22'}]},{id:92,p:{x:801.000000,y:330.000000,rad:27.69}, d:[{label: "BN",value: 30,color: '#E67E22'}]},{id:23,p:{x:813.000000,y:137.000000,rad:15.00}, d:[{label: "BN",value: 5,color: '#E67E22'}]},{id:84,p:{x:585.000000,y:52.000000,rad:30.00}, d:[{label: "BN",value: 35,color: '#E67E22'}]},{id:82,p:{x:506.367096,y:56.268311,rad:20.76}, d:[{label: "BN",value: 15,color: '#E67E22'}]},{id:60,p:{x:997.000000,y:484.000000,rad:27.69}, d:[{label: "BN",value: 30,color: '#E67E22'}]},{id:58,p:{x:875.000000,y:480.000000,rad:30.00}, d:[{label: "BN",value: 35,color: '#E67E22'}]},{id:57,p:{x:875.000000,y:372.000000,rad:23.07}, d:[{label: "BN",value: 20,color: '#E67E22'}]},{id:54,p:{x:823.000000,y:224.000000,rad:25.38}, d:[{label: "BN",value: 25,color: '#E67E22'}]},{id:24,p:{x:936.000000,y:543.000000,rad:18.46}, d:[{label: "BN",value: 10,color: '#E67E22'}]},{id:66,p:{x:1017.000000,y:674.000000,rad:15.00}, d:[{label: "BN",value: 5,color: '#E67E22'}]},{id:25,p:{x:966.000000,y:731.000000,rad:30.00}, d:[{label: "BN",value: 10,color: '#E67E22'}]},{id:87,p:{x:920.000000,y:656.000000,rad:19.56}, d:[{label: "BK",value: 24,color: '#ff0000'}]},{id:40,p:{x:324.000000,y:129.000000,rad:19.56}, d:[{label: "BN",value: 20,color: '#E67E22'}]},{id:76,p:{x:407.000000,y:87.000000,rad:22.17}, d:[{label: "BN",value: 30,color: '#E67E22'}]},{id:29,p:{x:669.000000,y:672.000000,rad:18.26}, d:[{label: "BK",value: 18,color: '#ff0000'}]},{id:86,p:{x:839.000000,y:686.000000,rad:18.26}, d:[{label: "BK",value: 18,color: '#ff0000'}]},{id:39,p:{x:317.000000,y:285.000000,rad:20.86}, d:[{label: "BK",value: 30,color: '#ff0000'}]},{id:75,p:{x:389.000000,y:260.000000,rad:22.17}, d:[{label: "BK",value: 36,color: '#ff0000'}]},{id:81,p:{x:583.000000,y:504.000000,rad:23.47}, d:[{label: "BK",value: 42,color: '#ff0000'}]},{id:34,p:{x:236.000000,y:419.000000,rad:30.00}, d:[{label: "BK",value: 42,color: '#ff0000'},{label: "BN",value: 25,color: '#E67E22'}]},{id:83,p:{x:627.000000,y:578.000000,rad:18.26}, d:[{label: "BK",value: 18,color: '#ff0000'}]},{id:36,p:{x:146.000000,y:283.000000,rad:27.39}, d:[{label: "BK",value: 24,color: '#ff0000'},{label: "BN",value: 30,color: '#E67E22'}]},{id:80,p:{x:543.000000,y:414.000000,rad:23.47}, d:[{label: "BK",value: 42,color: '#ff0000'}]},{id:33,p:{x:319.000000,y:476.000000,rad:24.78}, d:[{label: "BK",value: 18,color: '#ff0000'},{label: "BN",value: 25,color: '#E67E22'}]},{id:79,p:{x:453.000000,y:408.000000,rad:22.17}, d:[{label: "BK",value: 36,color: '#ff0000'}]},{id:32,p:{x:480.000000,y:588.000000,rad:19.56}, d:[{label: "BK",value: 6,color: '#ff0000'},{label: "BN",value: 15,color: '#E67E22'}]},{id:78,p:{x:455.000000,y:199.000000,rad:20.86}, d:[{label: "BN",value: 25,color: '#E67E22'}]},{id:31,p:{x:551.000000,y:631.000000,rad:19.56}, d:[{label: "BK",value: 24,color: '#ff0000'}]},{id:77,p:{x:459.000000,y:326.000000,rad:22.17}, d:[{label: "BK",value: 36,color: '#ff0000'}]},{id:30,p:{x:574.000000,y:701.000000,rad:23.47}, d:[{label: "BK",value: 42,color: '#ff0000'}]},{id:74,p:{x:289.000000,y:48.000000,rad:20.86}, d:[{label: "BN",value: 25,color: '#E67E22'}]},{id:51,p:{x:867.000000,y:601.000000,rad:22.17}, d:[{label: "BK",value: 36,color: '#ff0000'}]},{id:73,p:{x:320.000000,y:193.000000,rad:20.86}, d:[{label: "BK",value: 30,color: '#ff0000'}]},{id:72,p:{x:192.000000,y:78.000000,rad:20.86}, d:[{label: "BN",value: 25,color: '#E67E22'}]},{id:49,p:{x:728.000000,y:579.000000,rad:23.47}, d:[{label: "BK",value: 42,color: '#ff0000'}]},{id:71,p:{x:165.000000,y:173.000000,rad:20.86}, d:[{label: "BN",value: 25,color: '#E67E22'}]},{id:70,p:{x:101.000000,y:210.000000,rad:16.95}, d:[{label: "BN",value: 10,color: '#E67E22'}]},{id:47,p:{x:670.000000,y:508.000000,rad:19.56}, d:[{label: "BK",value: 24,color: '#ff0000'}]},{id:69,p:{x:311.000000,y:391.000000,rad:19.56}, d:[{label: "BK",value: 24,color: '#ff0000'}]},{id:22,p:{x:799.000000,y:544.000000,rad:18.26}, d:[{label: "BK",value: 18,color: '#ff0000'}]},{id:46,p:{x:582.000000,y:238.000000,rad:22.17}, d:[{label: "BN",value: 30,color: '#E67E22'}]},{id:45,p:{x:517.000000,y:197.000000,rad:23.47}, d:[{label: "BN",value: 35,color: '#E67E22'}]},{id:44,p:{x:504.000000,y:474.000000,rad:16.95}, d:[{label: "BK",value: 12,color: '#ff0000'}]},{id:43,p:{x:491.000000,y:128.000000,rad:22.17}, d:[{label: "BN",value: 30,color: '#E67E22'}]},{id:42,p:{x:384.000000,y:344.000000,rad:20.86}, d:[{label: "BK",value: 30,color: '#ff0000'}]},{id:41,p:{x:400.000000,y:152.000000,rad:22.17}, d:[{label: "BN",value: 30,color: '#E67E22'}]},{id:38,p:{x:250.000000,y:137.000000,rad:20.86}, d:[{label: "BN",value: 25,color: '#E67E22'}]},{id:37,p:{x:244.000000,y:193.000000,rad:20.86}, d:[{label: "BK",value: 30,color: '#ff0000'}]},{id:35,p:{x:217.000000,y:338.000000,rad:28.69}, d:[{label: "BK",value: 36,color: '#ff0000'},{label: "BN",value: 25,color: '#E67E22'}]},{id:21,p:{x:791.000000,y:642.000000,rad:18.26}, d:[{label: "BK",value: 18,color: '#ff0000'}]},{id:20,p:{x:573.000000,y:302.000000,rad:18.26}, d:[{label: "BN",value: 15,color: '#E67E22'}]},{id:19,p:{x:233.000000,y:264.000000,rad:24.78}, d:[{label: "BK",value: 24,color: '#ff0000'},{label: "BN",value: 20,color: '#E67E22'}]},{id:18,p:{x:121.000000,y:371.000000,rad:24.78}, d:[{label: "BK",value: 12,color: '#ff0000'},{label: "BN",value: 30,color: '#E67E22'}]},{id:17,p:{x:150.000000,y:454.000000,rad:27.39}, d:[{label: "BK",value: 18,color: '#ff0000'},{label: "BN",value: 35,color: '#E67E22'}]},{id:16,p:{x:251.000000,y:510.000000,rad:26.08}, d:[{label: "BK",value: 24,color: '#ff0000'},{label: "BN",value: 25,color: '#E67E22'}]},{id:15,p:{x:367.000000,y:559.000000,rad:23.47}, d:[{label: "BK",value: 12,color: '#ff0000'},{label: "BN",value: 25,color: '#E67E22'}]},{id:14,p:{x:408.000000,y:627.000000,rad:26.08}, d:[{label: "BK",value: 18,color: '#ff0000'},{label: "BN",value: 30,color: '#E67E22'}]},{id:13,p:{x:484.000000,y:689.000000,rad:26.08}, d:[{label: "BK",value: 30,color: '#ff0000'},{label: "BN",value: 20,color: '#E67E22'}]},{id:12,p:{x:636.352478,y:731.823364,rad:22.17}, d:[{label: "BK",value: 24,color: '#ff0000'},{label: "BN",value: 10,color: '#E67E22'}]},{id:11,p:{x:630.000000,y:322.000000,rad:15.00}, d:[{label: "BN",value: 5,color: '#E67E22'}]},{id:10,p:{x:130.000000,y:585.000000,rad:15.00}, d:[{label: "BN",value: 5,color: '#E67E22'}]},{id:9,p:{x:165.000000,y:558.000000,rad:19.56}, d:[{label: "BK",value: 18,color: '#ff0000'},{label: "BN",value: 5,color: '#E67E22'}]},{id:8,p:{x:286.000000,y:594.000000,rad:26.08}, d:[{label: "BK",value: 42,color: '#ff0000'},{label: "BN",value: 10,color: '#E67E22'}]},{id:7,p:{x:336.000000,y:665.000000,rad:26.08}, d:[{label: "BK",value: 30,color: '#ff0000'},{label: "BN",value: 20,color: '#E67E22'}]},{id:5,p:{x:730.277954,y:750.000000,rad:20.86}, d:[{label: "BK",value: 6,color: '#ff0000'},{label: "BN",value: 20,color: '#E67E22'}]},{id:4,p:{x:203.000000,y:629.000000,rad:20.86}, d:[{label: "BK",value: 24,color: '#ff0000'},{label: "BN",value: 5,color: '#E67E22'}]},{id:3,p:{x:249.000000,y:696.000000,rad:19.56}, d:[{label: "BK",value: 24,color: '#ff0000'}]},{id:2,p:{x:892.677246,y:735.287720,rad:16.95}, d:[{label: "BN",value: 10,color: '#E67E22'}]},{id:1,p:{x:818.498169,y:744.356934,rad:19.56}, d:[{label: "BN",value: 20,color: '#E67E22'}]},{id:6,p:{x:400.000000,y:716.000000,rad:20.86}, d:[{label: "BK",value: 6,color: '#ff0000'},{label: "BN",value: 20,color: '#E67E22'}]}];

				  var background = new Image();
				background.src = "./dap_temp_B_6_sig_c.png";
				//background.src = "./Temp_hum_no_label.png";
				
				// Make sure the image is loaded first otherwise nothing will draw.
				background.onload = function(){
					var ctx = canvas.getContext('2d');
					ctx.drawImage(background,0,0,1440,783);

					for(k=0;k<data.length;k++){
					 	var position = data[k].p;
					 	drawPie(canvas, position, data[k].d, data[k].id);
					 }

					 var nIDList=[
					 	{text:"10", nl:[52,42,33,34,36,29,22,23], style:{font:'bold 18pt Calibri',color:"black"}, offset:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]},
					 	{text:"11", nl:[26,33,44,56,60], style:{font:'bold 18pt Calibri',color:"black"}, offset:[[0,0],[0,0],[0,0],[0,0]]},
					 	{text:"01", nl:[51,46,56,58], style:{font:'bold 18pt Calibri',color:"black"}, offset:[[-10,0],[0,30],[0,30]]},
					 	{text:"10", nl:[72,73,74,67,60], style:{font:'bold 18pt Calibri',color:"black"}, offset:[[0,10],[-10,20],[0,-10],[0,30]]}
					 ];

					 for(n=0;n<nIDList.length;n++){
					 	var nlist = nIDList[n];
					 	

					 	for(j=1;j<nlist.nl.length; j++){
					 		var position={};

							for(k=0;k<data.length;k++){
						 		if(data[k].id == nlist.nl[j-1]){

						 			position.x1=data[k].p.x+nlist.offset[j-1][0];
						 			position.y1=777-data[k].p.y+nlist.offset[j-1][1];

						 		}else if(data[k].id == nlist.nl[j]){

						 			position.x2=data[k].p.x;
						 			position.y2=777-data[k].p.y;

						 		}
						 		
						 	}
						 	//drawText(canvas, nlist.text, position, nlist.style);
					 	}
					 
					 }


					 // Save as png
					 window.location = canvas.toDataURL("image/png");
				}

				
			
		</script>
	</body>

</html>